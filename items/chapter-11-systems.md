# 11장. 시스템

시스템이라는 높은 추상화 수준에서도 깨끗함을 유지하는 방법

## 시스템 생성(construction)과 시스템 사용(use)을 분리하라

관심사 분리는 우리 분야에서 가장 오래되고 가장 중요한 설계 기법 중 하나.

다음 두 관심사(concern)를 분리해야 체계적이고 탄탄한 시스템을 만들 수 있다:

- (애플리케이션 객체를 생성하고 의존성을 서로 '연결'하는) 시작 단계(startup process)
- (시작 단계 이후에 이어지는) 런타임 로직

두 관심사 분리에 실패한 전형적인 예: 초기화 지연 기법을 적용한 `getService()`

- 추상화가 아닌 구현체에 대한 의존성 (DIP 위반)
- 객체 생성과 객체 조회라는 두 가지 책임 (SRP 위반)
- 테스트 하기 불편함

시작 단계에서 주요 의존성을 해소하기 위한 방식 (간단한 것부터)

1. Main 분리
    - 생성과 관련한 코드는 모두 main이나 main이 호출하는 모듈에서 처리
    - 나머지 시스템은 모든 객체가 생성되었고 모든 의존성이 연결되었다고 가정 (애플리케이션은 객체 생성 과정을 전혀 모름)
1. Abstract factory 패턴
    - 객체를 생성하는 시점은 애플리케이션이 결정
    - 객체를 생성하는 코드는 애플리케이션이 모름
1. 의존성 주입(dependency injection, DI)
    - 애플리케이션은 객체 생성 책임을 맡지 않음 (SRP 지원)
    - '전담' 메커니즘이 객체를 생성하고 애플리케이션에 의존성을 주입 (제어 역전(inversion of control, IoC))
    - 초기 설정은 main 루틴이나 DI 컨테이너가 수행
    - DI 컨테이너가 실제 생성하는 객체 유형은 설정 파일이나 특수 생성 모듈에 명시
    - DI 컨테이너도 내부적으로 계산 지연과 같은 최적화 기법을 사용하고 있음

## 확장

소프트웨어 아키텍처는 물리적인 시스템과 달리, 관심사를 적절히 분리해 관리한다면 점진적으로 발전할 수 있다.

관심사를 적절히 분리하지 못하는 아키텍처의 예: EJB2

- 비즈니스 로직이 EJB 컨테이너에 강하게 결합된다.
- 독자적인 단위 테스트가 어렵다.
- 비즈니스 로직을 프레임워크 밖에서 재사용할 수 없다.
- 동일한 정보를 저장하는 별도의 DTO(data transfer object) 필요

횡단(cross-cutting) 관심사

- 영속성, 트랜잭션, 보안, ... : 애플리케이션 객체 경계를 넘나드는 경향이 있음
- 도메인 로직과 세밀한 단위로 겹치다보니 구현 코드가 온갖 객체로 흩어져 반복됨

관점 지향 프로그래밍(aspect-oriented programming, AOP)

- 관점
    - 특정 관심사를 지원하기 위해 일관된 방식으로 동작을 변경해야 하는 (시스템 상의) 지점
    - 간결한 선언이나 프로그래밍 메커니즘으로 지점을 명시
- 프로그래머가 객체에 관점을 명시해두면 AOP 프레임워크가 소스 코드에 영향을 미치지 않고 명시한 지점의 동작 방식을 변경한다.
- 자바에서 사용하는 메커니즘: 자바 프록시, 순수 자바 AOP 프레임워크, AspectJ

## 자바 프록시

