<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [9장. 단위 테스트](#9%EC%9E%A5-%EB%8B%A8%EC%9C%84-%ED%85%8C%EC%8A%A4%ED%8A%B8)
  - [TDD 법칙 세 가지](#tdd-%EB%B2%95%EC%B9%99-%EC%84%B8-%EA%B0%80%EC%A7%80)
  - [깨끗한 테스트 코드 유지하기](#%EA%B9%A8%EB%81%97%ED%95%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C-%EC%9C%A0%EC%A7%80%ED%95%98%EA%B8%B0)
  - [깨끗한 테스트 코드](#%EA%B9%A8%EB%81%97%ED%95%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C)
  - [테스트 당 assert 하나?](#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8B%B9-assert-%ED%95%98%EB%82%98)
  - [F.I.R.S.T](#first)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# 9장. 단위 테스트

테스트를 추가에만 급급한 나머지 제대로 된 테스트 케이스를 작성해야 한다는 중요한 사실을 놓치고 있지는 않은가?

## TDD 법칙 세 가지

'실제 코드를 짜기 전에 단위 테스트부터 짜라'는 규칙은 빙산의 일각에 불과하다.

세 가지 법칙

1. 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
1. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
1. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

효과

- 개발과 테스트가 대략 30초 주기로 묶인다.
- 테스트 코드가 실제 코드보다 불과 몇 초 전에 나온다.
- 방대한 테스트 코드가 나온다.
    - 매일 수십 개에 달하는 테스트 케이스
    - 실제 코드를 사실상 전부 테스트하는 테스트 케이스

실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 한다.

## 깨끗한 테스트 코드 유지하기

지저분한 테스트 코드의 결말

- 실제 코드가 진화하면 테스트 코드도 변해야 한다.
- 테스트 코드가 지저분할 수록 변경이 어려워지고, 이 부담은 계속 늘어난다.
- 테스트 코드가 비난의 대상이 되고, 결국 폐기된다.
- 코드는 망가지고, 테스트에 대한 실망감만 남는다.

테스트 코드는 실제 코드 못지 않게 중요하다.

- 테스트는 유연성, 유지보수성, 재사용성을 제공한다.
    - 테스트 케이스가 있으면 안심하고 아키텍처와 설계를 개선할 수 있다.
- 실제 코드와 같은 규칙을 적용하여 깨끗하게 짜야 한다.

## 깨끗한 테스트 코드

FitNess 예제

- 리팩터링 전
    - 중복되는 코드가 매우 많고 자질구레한 사항이 너무 많아 테스트 코드의 표현력이 떨어진다.
    - 온갖 잡다하고 무관한 코드를 파악한 후에 간신히 테스트 의도를 이해할 수 있다.
- 리팩터링 후
    - BUILD-OPERATE-CHECK 패턴의 명확한 테스트 구조
    - 중복 제거, 메서드 추출 
        - 진짜 필요한 자료 유형과 함수만 사용
        - 코드가 수행하는 기능을 재빨리 이해

리팩터링을 통해 도메인에 특화된 테스트 언어로 작성된 간결하고 표현력이 풍부한 테스트 코드를 만들어내라.

이중 표준

- 테스트 코드는 실제 코드만큼 효율적일 필요는 없다.
- 가독성을 높이기 위해 특정 규칙을 변형하여 적용하기도 하지만, 코드의 깨끗함은 해치지 말아야 한다.

## 테스트 당 assert 하나?

개념 당 assert 문 수를 최소로 줄여라.

- '단일 assert 문'은 훌륭한 지침이지만
    - 결론이 하나라서 코드를 이해하기 쉽고 빠르다.
    - given-when-then 관례를 사용하면 테스트 코드 읽기가 쉬워진다.
- 테스트를 지나치게 분리하면 중복된 코드가 많아진다.
    - 중복을 제거할 수 있는 기술적인 방법은 존재하지만, 보통 배보다 배꼽이 큰 격이다.

테스트 함수 하나는 개념 하나만 테스트하라.

- 독자적인 개념 여러 개를 하나의 테스트 함수에 몰아넣으면 독자가 각 절이 거기에 존재하는 이유와 각 절이 테스트하는 개념을 모두 이해해야 한다.

## F.I.R.S.T

깨끗한 테스트의 다섯 가지 규칙

- **F**ast (빠르게)
    - 테스트가 느리면 자주 돌릴 수 없고,그 결과 초반에 문제를 찾아내 고치지 못한다.
- **I**ndependent (독립적으로)
    - 테스트가 서로에게 의존하면 하나가 실패할 때 나머지도 잇달아 실패하므로 원인을 진단하기 어려워지며 후반 테스트가 찾아내야 할 결함이 숨겨진다.
- **R**epeatable (반복가능하게)
    - 어떤 상황에서도
- **S**elf-validating (자가검증하는)
- **T**imely (적시에)
    - 테스트하려는 실제 코드를 구현하기 직전에 구현한다.
    - 그렇지 않으면 테스트 하기 어려운 코드가 만들어지기 마련이다.
