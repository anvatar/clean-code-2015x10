# 8장. 경계

## 외부 코드 사용하기

문제: 외부 코드가 사용자에게 필요하지 않은 기능까지 제공한다.

- 패키지 제공자는 적용성을 최대한 넓히려 애쓴다.
- 사용자는 자신의 요구에 집중하는 인터페이스를 바란다.

해결 방안: 경계 인터페이스를 직접 작성한 클래스 안으로 숨긴다.

- 외부 코드가 변하더라도 프로그램의 나머지 부분에는 영향을 미치지 않는다.
- 프로그램에 필요한 인터페이스만 제공한다.
    - 이해하기 쉽고 오용하기는 어려운 코드를 작성할 수 있다.
    - 설계•비즈니스 규칙을 따르도록 강제할 수 있다.
- 외부 클래스의 인스턴스를 공개 API의 인수로 받거나 반환값으로 사용하지 말라.

## 경계 살피고 익히기

흔히 겪는 문제

1. 외부 라이브러리 문서를 읽은 뒤 코드를 작성하고 예상대로 동작하는지 확인한다.
1. 문제가 생겼을 때 우리 버그인지 라이브러리 버그인지 찾아내느라 고생한다.

학습 테스트

- 먼저 간단한 테스크 케이스를 작성하면서 외부 코드를 익힌다.
- 통제된 환경에서 API를 제대로 이해하는지를 확인한다.

## 사례: log4j 익히기

1. 패키지 소개 페이지만 보고 첫 번째 테스트 케이스를 작성한다.
1. 테스트가 실패하면 문서를 좀 더 읽어보고 테스트 케이스를 보완한다.
1. 의문 가는 부분에 대해 정보를 찾아가며 테스트 케이스를 추가하기를 반복한다.
1. 얻은 지식을 독자적인 로그 클래스로 캡슐화한다. 이제 프로그램의 나머지 부분은 log4j 경계 인터페이스를 몰라도 된다.

## 학습 테스트는 공짜 이상이다

학습 테스트는 필요한 지식만 확보하는 손쉬운 방법이자 이해도를 높여주는 정확한 실험이다.

투자하는 노력보다 얻는 성과가 더 크다.

- 외부 패키지의 새 버전이 나올 때마다 바로 호환성을 검증해볼 수 있다.
- 새 버전으로 이전하기 쉬워진다.

## 아직 존재하지 않는 코드를 사용하기

우리가 바라는 인터페이스를 미리 선언해놓고 이를 이용하는 코드를 작성한다.

- 코드 가독성도 높아지고 코드의 의도도 분명해진다.
- 나중에 저쪽 인터페이스가 정의되면 ADAPTER 패턴으로 API 사용을 캡슐화해 API가 바뀔 때 수정할 코드를 한 곳으로 모은다.
- 직접 선언한 인터페이스를 경계로 양쪽을 독립적으로 테스트 하기도 쉽다.

## 깨끗한 경계

통제 불가능한 외부 패키지에 의존하지 말고 통제 가능한 우리 코드에 의존하라.

- 경계에 위치하는 코드는 깔끔히 분리한다.
- 외부 코드에게 기대하는 동작을 정의하는 테스트 케이스도 작성한다.

외부 패키지를 호출하는 코드를 가능한 한 줄인다.

- 새로운 클래스로 경계를 감싸거나 ADAPTER 패턴을 사용하여 인터페이스를 변환한다.
- 코드 가독성과 일관성이 높아지며, 외부 패키지가 변했을 때 변경할 코드도 줄어든다.
